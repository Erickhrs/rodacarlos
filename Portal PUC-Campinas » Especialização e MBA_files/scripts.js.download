(function($) {
  "use strict"; // Start of use strict
  // Smooth scrolling using jQuery easing
  $('a.js-scroll-trigger[href*="#"]:not([href="#"])').click(function() {
    if (location.pathname.replace(/^\//, '') == this.pathname.replace(/^\//, '') && location.hostname == this.hostname) {
      var target = $(this.hash);
      target = target.length ? target : $('[name=' + this.hash.slice(1) + ']');
      if (target.length) {
        $('html, body').animate({
          scrollTop: (target.offset().top - 50)
        }, 100, "easeInOutExpo");
        return false;
      }
    }
  });
})(jQuery); // End of use strict

// função slider cursos
$(function(){
  $('.slick').slick({
    slidesToShow: 4,
    slidesToScroll: 4,
    autoplay: false,
    autoplaySpeed: 10000,
    infinite: false,
    arrows: false,
    dots: true,
    rows: 3,
    responsive: [
        {
            breakpoint: 576,
            settings: {
                slidesToShow: 1,
                slidesToScroll: 1,
                rows: 4,
            }
        },
        {
            breakpoint: 768,
            settings: {
                slidesToShow: 1,
                slidesToScroll: 1,
                rows: 4,
            }
        },
        {
            breakpoint: 992,
            settings: {
                slidesToShow: 1,
                slidesToScroll: 1,
                rows: 4,
            }
        }
    ]
  });
});

function toNormalForm(str) {
  return str.normalize("NFD").replace(/[\u0300-\u036f]/g, ""); //normaliza acentos
}

//nome cursos
$(".filter").on("keyup", function() {

  var input = $(this).val().toUpperCase();
  var qtdAtivos = 0;
  if(input.length > 0){
    $('#cursos').css("display", "none");
    $('#cursos-graduacao').css("display", "block");
    $("#nossos-cursos .bloco-filtro .card").each(function() {
      var textCard = toNormalForm ( $(this).html().toUpperCase() );
    //console.log(textCard);
    if ( textCard.indexOf(input) < 0 ) {
        $(this).parent().parent().hide();
      } else {
        $(this).parent().parent().show();
        $('.resultado-busca-cursos').hide();
        qtdAtivos++ 
      }
    })
    if(input.length > 0 && qtdAtivos == 0){
      $('.resultado-busca-cursos').show();
    }

  }else{

    $("#nossos-cursos .bloco-filtro .card").each(function() {
        $(this).parent().parent().show();
    })
    $('.resultado-busca-cursos').hide();
    $('#cursos').css("display", "block");
    $('#cursos-graduacao').css("display", "none");
  }
});

//lazyloader
$("img.lazy").lazyload({
  effect : "fadeIn"
});
$("div.lazy").lazyload({
  effect : "fadeIn"
});

//wow animate
new WOW().init();

//carrossel - slick
$('.slick-infra').slick({
  autoplay: true,
  dots: true,
  slidesToShow: 2,
  slidesToScroll: 2,
  arrows: false,
});
$('#slick-depoimentos').slick({
  autoplay: false,
  dots: true,
  centerMode: true,
  arrows: true,
  slidesToShow: 3,
  slidesToScroll: 1,
  responsive: [
    {
      breakpoint: 768,
      settings: {
        slidesToShow: 3,
        slidesToScroll: 1,
        arrows: false,
        dots: false,
        centerMode: true,
        variableWidth: true,
        infinite: true,
        focusOnSelect: true,
        touchMove: true,
      }
    }
  ]
});

$(document).ready(function() {
  
 /** $(window).on("load scroll", function() {
    
    //parallax scroll
    var parallaxElements = $(".parallax_scroll");
    window.requestAnimationFrame(function() {
      parallaxElements.each(function() {
        var currentElement = $(this),
            speed = parseFloat(currentElement.attr("speed")) || 1, // Usa 1 como padrão se não for definido
            windowTop = $(window).scrollTop(),
            elementTop = currentElement.offset().top,
            elementHeight = currentElement.height(),
            viewPortHeight = window.innerHeight * 0.5 - elementHeight * 0.5,
            scrolled = windowTop - elementTop + viewPortHeight;

        currentElement.css({
          transform: "translate3d(" + (scrolled * speed) + "px, 0, 0)"
        });
      });
    });
  }); */
});

$(window).scroll(function(){

  const windowheight = $( window ).height();
  const perspectivas = $('#perspectivas');
  const offset_perspectivas = perspectivas.position();
  const inovacao = $('#inovacao');
  const offset_inovacao = inovacao.position();

  var scroll = $(window).scrollTop();

  if ($(this).scrollTop() >= offset_perspectivas.top - windowheight) {
     $('#digit_persp').addClass('typewriter');
  } else {
     $('#digit_persp').removeClass('typewriter');
  }

  if ($(this).scrollTop() >= offset_inovacao.top - windowheight) {
    $('#digit_inova').addClass('typewriter-impulsiona');
 } else {
    $('#digit_inova').removeClass('typewriter-impulsiona');
 }

});

// Filtros dos cursos

$(document).ready(function () {

  $('.filter-area').on('change', function () {
    if ($('.filter-area').is(':checked')) {
      $('#cursos').css("display", "none");
      $('#cursos-graduacao').css("display", "block");

      var groups = {};
      $('#cursos-graduacao .curso').each(function () {
        var areaName = this.getAttribute('data-area');
        var $group = groups[areaName];

        if (!$group) {
          // Cria o grupo e adiciona ao DOM
          $group = $('<div />', {
            'class': 'row group'
          });
          // Insere o grupo no DOM
          $('#cursos-graduacao').append($group);

          // Adiciona o título ao grupo
          $('<h3 class="py-4">' + areaName + '</h3>').appendTo($group);
          groups[areaName] = $group;
        }

        // Adiciona o curso ao grupo correto
        $group.append(this);
      });
    } else {
      $('#cursos').css("display", "block");
      $('#cursos-graduacao').css("display", "none");
      $('#cursos-graduacao h3').each(function () {
        $(this).remove();
      });
      $('.group').each(function () {
        // Substitua o elemento pela sua marcação interna
        $(this).replaceWith($(this).contents());
      });
    }
  });

    $('.filter-checkbox').on('change', function () {
      if ($('.filter-checkbox:checked').length > 0) {
        $('#cursos').css("display", "none");
        $('#cursos-graduacao').css("display", "block");
      } else {
        $('#cursos').css("display", "block");
        $('#cursos-graduacao').css("display", "none");
      }

      // Se a checkbox foi marcada
      if ($(this).is(':checked')) {
        // Desmarcar todas as outras checkboxes
        $('.filter-checkbox').not(this).prop('checked', false);
      }

      // Filtrar os cards com base na checkbox selecionada
      var selectedCategory = $('.filter-checkbox:checked').val();

      $('.bloco-filtro .curso').each(function () {
        var cardCategories = $(this).data('categories').split(' ');
        var isVisible = !selectedCategory || cardCategories.includes(selectedCategory);
        $(this).toggle(isVisible);
      });
    });
  });

/* Ini Swiper */

if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {

  var swiper = new Swiper(".mySwiper", {
    effect: "cards",
    grabCursor: true,
    loop: true,
  });
} else {
  var swiper = new Swiper(".mySwiper", {
    slidesPerView: 1,
    spaceBetween: 30,
    loop: true,
    pagination: {
      el: ".swiper-pagination",
      clickable: true,
    },
    breakpoints: {
      576: {
        slidesPerView: 3
      },
      992: {
        slidesPerView: 5
      }
    }
  });
}

swiper.on('slideChange', function () {
  $('.dep-videos').each(function () {
    $(this).get(0).pause(); // Stop todos
    $(this).parent().find(".btnply").removeClass('active');
    $(this).parent().find(".btnply").show();
    $(this).parent().find(".btnslide").remove();
  });
});

$(".dep-videos").on("click", function () {

  $('.dep-videos').not(this).each(function () {
    $(this).get(0).pause(); // Stop todos
    $(this).parent().find(".btnply").removeClass('active');
    $(this).parent().find(".btnply").show();
  });
  
  $(this).parent().find(".btnply").toggleClass('active');
  var video = $('.dep-videos');
  var vi = $('.dep-videos').index(this);

  video[vi].addEventListener('ended', function () {
    video[vi].currentTime = 0;
    video[vi].pause();
    $(this).parent().find(".btnply").removeClass('active');
    $(this).parent().find(".btnply").fadeIn(0);
  });

  if (video[vi].paused == true) {
    // Play
    $(this).parent().find(".btnply").delay(1000).fadeOut(200);
    video[vi].play();

  } else {
    // Pause
    $(this).parent().find(".btnply").fadeIn(0);
    video[vi].pause();

  }
});

//script para carregamento da tab de formas de ingresso
//http://vestibularpuccampinas.local/#formas-de-ingresso#tab1-menu-vestibular|#tab4-conteudo1-vestibular
document.addEventListener("DOMContentLoaded", function () {
  const hash = window.location.hash;

  if (hash) {
      // Dividir o hash em scroll, primaryHash e secondaryHash
      const [scrollTarget, primaryHash, secondaryHash] = hash.split('|');

      if(scrollTarget && primaryHash && secondaryHash){
        // Realizar o scroll até o elemento de destino
        if (scrollTarget) {
          const scrollElement = document.querySelector(scrollTarget);
          if (scrollElement) {
              // Calcular o deslocamento manual
              const offset = 80; // Espaço acima em pixels
              const elementPosition = scrollElement.getBoundingClientRect().top + window.pageYOffset;
              const offsetPosition = elementPosition - offset;

              // Fazer o scroll com o deslocamento
              window.scrollTo({
                  top: offsetPosition,
                  behavior: "smooth",
              });
          }
        }

        // Ativar o tab principal
        if (primaryHash) {
          const primaryTabButton = document.querySelector(`button[data-bs-target="${primaryHash}"]`);
          const primaryTabContent = document.querySelector(primaryHash);

          if (primaryTabButton && primaryTabContent) {
              // Remover classes 'active' e 'show' dos tabs principais
              document.querySelectorAll('.nav-link.active, .tab-pane.active').forEach(element => {
                  element.classList.remove('active', 'show');
              });

              // Ativar o tab principal
              primaryTabButton.classList.add('active');
              primaryTabContent.classList.add('active', 'show');
          }
        }

        // Ativar o tab secundário
        if (secondaryHash) {
          const secondaryTabButton = document.querySelector(`button[data-bs-target="${secondaryHash}"]`);
          const secondaryTabContent = document.querySelector(secondaryHash);

          if (secondaryTabButton && secondaryTabContent) {
              // Remover classes 'active' e 'show' dos tabs secundários
              const parentTabContent = document.querySelector(primaryHash);
              if (parentTabContent) {
                  parentTabContent.querySelectorAll('.nav-link.active, .tab-pane.active').forEach(element => {
                      element.classList.remove('active', 'show');
                  });

                  // Ativar o tab secundário
                  secondaryTabButton.classList.add('active');
                  secondaryTabContent.classList.add('active', 'show');
              }
          }
        }
      }
  }
});

$(window).on("load", function() {
    $('select[name=cf_momento_vestibular_2025] > option:first-child').text('Seu momento no ensino superior');  // Hack form RD Station - header
    $('input[name=personal_phone]').attr('maxlength', '19');  // Hack form RD Station - campos fone
});